# Examine Alerts, Logs, and Rules with Suricata

In this activity, you explored the practical application of Suricata, an open-source intrusion detection system (IDS), to monitor network traffic, create custom rules, and analyze logs generated by these rules.

## Activity Overview

You previously learned about packet analysis and the basic syntax of IDS signatures and rules. In this lab, you applied that knowledge to:

1. **Examine a Custom Rule in Suricata**: You explored the composition of a rule defined in the `custom.rules` file.
2. **Trigger a Custom Rule in Suricata**: You ran Suricata with a custom rule to trigger alerts and examined the output logs in the `fast.log` file.
3. **Examine `eve.json` Output**: You analyzed additional detailed output generated by Suricata in the `eve.json` file.

## Task 1: Examine a Custom Rule in Suricata

- **Custom Rule Components**:

  - **Action**: The first part of the rule, which determines the action to take if all conditions are met. Common actions include `alert`, `drop`, `pass`, and `reject`.
  - **Header**: Defines the signature's network traffic attributes, including protocols, source/destination IP addresses, ports, and traffic direction.
  - **Rule Options**: Customizable parameters that allow for fine-tuning of the rule.

- **Example Rule**:

  ```bash
  alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"GET on wire"; flow:established,to_server; content:"GET"; http_method; sid:12345; rev:3;)
  ```

  - **Action**: `alert` (triggers an alert on matching traffic).

  - **Header**: Monitors HTTP traffic from the home network (`$HOME_NET`) to an external network (`$EXTERNAL_NET`).

  - Rule Options

    :

    - `msg:"GET on wire"`: Message displayed when the alert is triggered.
    - `flow:established,to_server`: Matches packets from the client to the server.
    - `content:"GET"`: Searches for the word `GET` in the HTTP method.
    - `sid:12345`: Unique signature ID.
    - `rev:3`: Revision version of the signature.

## Task 2: Trigger a Custom Rule in Suricata

- **Running Suricata**:

  - Used the command `sudo suricata -r sample.pcap -S custom.rules -k none` to run Suricata with the custom rules against the `sample.pcap` file.
  - Suricata processed the packets and generated alerts when the conditions in the custom rule were met.

- **Examining `fast.log`**:

  - Located in `/var/log/suricata/fast.log`.

  - Contains minimal alert information, including source and destination IP addresses, ports, and the triggered alert message.

  - Example Output

    :

    ```bash
    11/23/2022-12:38:34.624866  [**] [1:12345:3] GET on wire [**] {TCP} 172.21.224.2:49652 -> 142.250.1.139:80
    ```

## Task 3: Examine `eve.json` Output

- **Exploring `eve.json`**:

  - `eve.json` is the main Suricata log file, containing detailed event and alert data in JSON format.
  - It provides more verbose information compared to `fast.log`, making it useful for detailed analysis and processing.

- **Using `jq` for Better Formatting**:

  - The `jq` command was used to format and filter the JSON data for easier reading and analysis.

  - Example command: `jq . /var/log/suricata/eve.json | less`.

  - Extracted specific fields like 

    ```
    timestamp
    ```

    , 

    ```
    flow_id
    ```

    , 

    ```
    alert.signature
    ```

    , 

    ```
    proto
    ```

    , and 

    ```
    dest_ip
    ```

     using:

    ```bash
    jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json
    ```

  - Example Output

    :

    ```json
    ["2022-11-23T12:38:34.624866+0000",14500150016149,"GET on wire","TCP","142.250.1.139"]
    ```

## Conclusion

You have successfully completed the lab activity with Suricata, gaining hands-on experience in:

- Creating and customizing IDS rules.
- Monitoring and analyzing network traffic using packet capture files.
- Examining Suricata log outputs, including `fast.log` and `eve.json`.

These skills are essential as you progress in your journey to becoming a security analyst, enhancing your ability to detect, analyze, and respond to security incidents effectively.